# PRODAdvert

![type checked: mypy](https://img.shields.io/badge/mypy-type%20checked-green)
[![ruff](https://img.shields.io/badge/style-ruff-41B5BE?style=flat)](https://github.com/astral-sh/ruff)

![python 3.13+](https://img.shields.io/badge/python-3.13+-blue)
[![License](https://img.shields.io/badge/license-GNU%20GPLv3-green)](./LICENSE)

![](backend/tests-badge.svg)
![](backend/coverage-badge.svg)

* [Запуск](#запуск)
* [Документация API](#документация-api)
* [Точки входа](docs/entrypoints.md)
* [Функции и демонстрация](docs/features.md)
* [Структура C4 и БД](docs/structure.md)
* [Алгоритмы](docs/sequences.md)
* [Стек технологий](#стек-технологий)
* [Используемые заимствования](#используемые-заимствования)
* [Лицензия и авторство](#лицензия-и-авторство)

## Запуск

Для запуска необходимо определить переменные окружения:
- `DB_USER`, `DB_PASS` - пользователь/его пароль для базы данных
- `S3_USER`, `S3_PASS` - пользователь/его пароль для файлового хранилища
- `BOT_TOKEN` - токен телеграм-бота

Стандартные значения переменных окружения уже предоставлены
в файле `.env`.

Затем:
```sh
cd soluton
docker compose up -d
```

Для контейнера с бэкендом определен healthcheck. Healthy состояние контейнера
гарантирует работоспособность бэкенда. Бот становится работоспособен спустя
примерно 15-20 секунд после перехода бэкенда в состояние healthy.

Запуск бэкенда происходит на 8080 порте.

## Документация API

Swagger автоматически развертывается на бэкенде по
пути `/docs`.

## Стек технологий

### Бэкенд

| Тип       | Название   | Причина выбора                                                                                                                |
|-----------|------------|-------------------------------------------------------------------------------------------------------------------------------|
| Фреймворк | Litestar   | Хороший быстрый асинхронный веб-фреймворк. Похож на FastAPI, но имеет больше "батареек"                                       |
| DI        | dishka     | Простой, удобный, асинхронный, с autowiring'ом, финализацией и областями видимости фреймворк для DI. Вобрал в себя все лучшее |
| ORM       | SQLAlchemy | Эффективная и безопасная работа с базой, облегченное моделирование                                                            |

### Бот

| Тип               | Название   | Причина выбора                                                                                                               |
|-------------------|------------|------------------------------------------------------------------------------------------------------------------------------|
| Работа с telegram | aiogram    | Популярная, удобная, а главное - асинхронная библиотека для телеграм-ботов                                                   |
| DI                | dishka     | Простой, удобный, асинхронный, с autowiring'ом, финализацией и областями видимости фреймворк для DI. Вобрал в себя все лучшее |
| Графики           | matplotlib | Де-факто стандарт в построении графиков в Python. Удобство, кроссплатформенность и кастомизируемость                         |

### Persistence

| Тип                | Название | Причина выбора                                     |
|--------------------|----------|----------------------------------------------------|
| СУБД               | Postgres | opensource, быстрый                                |
| Файловое хранилище | Minio    | opensource, S3-совместимый, высокопроизводительный |

### Статистика и мониторинг

| Тип          | Название   | Причина выбора                                                |
|--------------|------------|---------------------------------------------------------------|
| Сбор метрик  | Prometheus | opensource, популярность                                      |
| Визуализация | Grafana    | opensource, гибкая, много возможностей для разграничения прав |


## Зависимости от внешних сервисов

- DuckDuckGo AI - бесплатный безлимитный ИИ с несколькими моделями на выбор.

## Используемые заимствования

- Темплейт + стркутура проекта - [Sehat1137/litestar-dishka-faststream](https://github.com/Sehat1137/litestar-dishka-faststream/)
- Синглтон модель https://gist.github.com/kovalbogdan95/73561ffb625915bbe6fa0465cb7f6bc3
- Базовые настройки Ruff - [wemake-services/wemake-python-styleguide](https://github.com/wemake-services/wemake-python-styleguide)
- Туториал по настройке Prometheus https://www.dmosk.ru/miniinstruktions.php?mini=prometheus-stack-docker
- Настрока импортов дешбордов в Grafana https://stackoverflow.com/questions/63518460/grafana-import-dashboard-as-part-of-docker-compose

## Лицензия и авторство

Разработчик: Илья Солин [@Tapeline](https://github.com/Tapeline)

Данная работа лицензирована на условиях GNU GPL v3
